require(["jira/analytics","jira/dialog/form-dialog","aui/params","underscore","jquery","jira/util/logger"],function(e,t,i,n,s,a){"use strict";function o(){s("#selectedOptionsRemoveAll").click(function(e){m("selectedOptions","availableOptions"),e.preventDefault()}),s("#selectedOptionsAddAll").click(function(e){m("availableOptions","selectedOptions"),e.preventDefault()}),s("#selectedOptions").sortable({opacity:.7,connectWith:[document.getElementById("availableOptions")],update:function(e,t){t.sender||"availableOptions"===t.item.parent()[0].id||f("reordered")},receive:function(){f("added")},remove:function(){f("removed")}}),i.allowEditOptions&&s("#availableOptions").sortable({update:p,opacity:.7,connectWith:[document.getElementById("selectedOptions")]}),s("#submitSave").click(function(){r(this)}),s("#submitReset").click(function(e){i.resetUrl&&(s(this).removeDirtyWarning(),window.location=i.resetUrl),e.preventDefault()}),s("#issue-type-scheme-name, #issue-type-scheme-description, #default-issue-type-select").change(u),new t({trigger:"#add-new-issue-type-to-scheme",id:"add-new-issue-type-to-scheme-dialog",ajaxOptions:{data:{decorator:"dialog",inline:"true"}},onSuccessfulSubmit:function(t){var i=s("<div>").html(t).find("#add-issue-type-template");i.find("li").appendTo("#selectedOptions");var n=i.find("select");n.length>0&&(s("#default-issue-type-select").unbind().replaceWith(n),n.attr("id","default-issue-type-select").change(u)),p(),e.send({name:"administration.issuetypeschemes.issuetype.created.global"})},onDialogFinished:function(){this.hide()}}),s("#add-new-issue-type-to-scheme").attr("formDialogBound","1"),p(),a.trace("jira.edit.issuetypescheme.initialized")}var c=[{selector:"#issue-type-scheme-name",name:"schemeName"},{selector:"#issue-type-scheme-description",name:"schemeDescription"},{selector:"input[name='fieldId']",name:"fieldId"},{selector:"input[name='schemeId']",name:"schemeId"},{selector:"input[name='projectId']",name:"projectId"},{selector:"#default-issue-type-select",name:"defaultOption"}],l=void 0,d=function(){var e=s("#selectedOptions").sortable("serialize",{key:"selectedOptions"});return""===e?"selectedOptions=":e},r=function(e){return e.form.action="ConfigureOptionSchemes.jspa?"+d(),!0},u=function(){for(var e="AddNewIssueTypeToScheme!input.jspa?"+d(),t={},i=0;i<c.length;i++){var n=s(c[i].selector);t[c[i].name]=n.val()}e=e+"&"+s.param(t),s("#add-new-issue-type-to-scheme").attr("href",e)},p=function(){var e=d().replace(/selectedOptions=/g,""),t=e.split("&"),i=document.getElementById("default-issue-type-select");s.each(i.options,function(e,n){""===n.value||s.inArray(n.value,t)>-1?s(n).css({display:"",color:"#000",textDecoration:"none"}).removeAttr("disabled"):(n.selected&&(n.selected=!1,i.options[0].selected=!0),s(n).css({display:"none",color:"#ffcccc",textDecoration:"line-through"}).attr("disabled","disabled"))}),u()},m=function(e,t){s("#"+e).find("li").appendTo(document.getElementById(t)),p()},f=function(t){n.isUndefined(l)&&((l=s("input[name=schemeId]").val())||(l=!1)),l&&e.send({name:"administration.issuetypeschemes.issuetype."+t+".global"})};s(o)});