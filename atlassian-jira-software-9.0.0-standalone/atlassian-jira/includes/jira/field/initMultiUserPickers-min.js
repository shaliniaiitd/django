define("jira/field/init-multi-user-pickers",["jquery","wrm/context-path","jira/ajs/select/multi-select","jira/util/events/reasons","jira/util/events/types","jira/util/events","jira/field/no-browser-user-name-picker","jira/field/user-picker-util","jira/ajs/list/item-descriptor","jira/field/create-user-picker-popup-trigger","jira/util/logger"],function(e,t,r,i,n,a,o,l,u,c,s){"use strict";function d(e){return!1!==e}function f(e){if(e)return String(e).split(",").filter(function(e){return e})}function p(e){return{useFrotherControl:e.data("use-frother-control"),userPickerEnabled:e.data("user-picker-enabled"),fieldName:e.data("field-name"),formName:e.data("form-name"),fieldConfigId:e.data("field-config-id"),multiSelect:e.data("multi-select"),projectId:f(e.data("project-id")),actionToOpen:e.data("action-to-open")}}function m(t){t.find(".js-default-multi-user-picker").each(function(){var r=e(this),i=r.attr("id"),n=t.find("#"+i+"_container").find(".popup-trigger"),a=p(r);n.length>0&&h(n,a),d(a.useFrotherControl)&&(a.userPickerEnabled?g(r,a):j(r))})}function j(e){new o({element:e})}function g(e,t){new r({element:e,itemAttrDisplayed:"label",showDropdownButton:!1,removeOnUnSelect:!0,submitInputVal:!0,events:{element:{"userpicker:onPopUpSelection":function(e,t,r,i){try{JSON.parse(i).forEach(function(e){var t=e.id,i=e.displayName;r.addItem(new u({value:t,title:i,label:i}))})}catch(e){s.error("Cannot parse user names")}}}},ajaxOptions:{url:k+"/rest/api/1.0/users/picker",data:function(r){return{showAvatar:!0,query:r,exclude:e.val(),fieldName:t.fieldName,fieldConfigId:t.fieldConfigId,projectId:t.projectId}},formatResponse:l.formatResponse}})}function h(e,t){e.on("click",c.createUserPickerPopupTrigger({urlBase:k,formName:t.formName||e.closest("form").attr("name"),fieldName:t.fieldName,multiSelect:t.multiSelect,fieldConfigId:t.fieldConfigId,projectIds:t.projectId,actionToOpen:t.actionToOpen,triggerEvent:d(t.useFrotherControl)?"userpicker:onPopUpSelection":void 0}))}var k=t();return a.bind(n.NEW_CONTENT_ADDED,function(e,t,r){r!==i.panelRefreshed&&m(t)}),m});