AJS.test.require(["jira.webresources:shifter"],function(){"use strict";function e(e){return{name:"jira.dotdialog.selection",data:n.extend({lang:"en"},e)}}var t,l=require("jira/shifter/shifter-analytics"),a=require("jira/util/data/meta"),i=require("jira/analytics"),n=require("underscore"),s=sinon.assert,o=sinon.match,c={setup:function(){this.sandbox=sinon.sandbox.create(),this.sandbox.stub(a,"get").returns("en"),t=this.sandbox.stub(i,"send")},teardown:function(){this.sandbox.restore()}};module("ShifterAnalytics#show",c),test("should trigger an event",function(){l.show(),s.calledOnce(t),s.calledWith(t,{name:"jira.dotdialog.show",data:void 0})}),module("ShifterAnalytics#selection",c),test("shouldn't trigger if there are not enough parameters",function(){l.selection(),l.selection("label"),l.selection("label","value"),l.selection("label","value","group-id"),s.calledOnce(t),s.calledWith(t,o.has("name","jira.dotdialog.selection"))}),test("should hash labels that are potentially user-entered",function(){l.selection("label","value","group-id"),s.calledOnce(t),s.calledWith(t,e({group:"group-id",selected:"102727412"}))}),test("shouldn't hash values in white-listed groups",function(){n.each(l.selection.privacyPolicySafeGroups,function(a){l.selection("label","value",a),s.calledWith(t,e({group:a,selected:"label"}))}),s.calledTwice(t)}),test("shouldn't hash white-listed values",function(){n.each(l.selection.privacyPolicySafeLabels,function(a){l.selection(a,"value","group-id"),s.calledWith(t,e({group:"group-id",selected:a}))}),s.callCount(t,8)}),test('should use values and not labels for system fields in "edit-fields" group',function(){l.selection("label","value","edit-fields"),s.calledOnce(t),s.calledWith(t,e({group:"edit-fields",selected:"value"}))}),test('should hash custom fields in "edit-fields" group',function(){l.selection("label","customfield_123","edit-fields"),s.calledOnce(t),s.calledWith(t,e({group:"edit-fields",selected:"102727412"}))}),test("Should extract language from the locale",function(){a.get.returns("te_ST"),l.selection("label","value","group"),s.calledOnce(t),s.calledWith(t,{name:"jira.dotdialog.selection",data:{lang:"te",group:"group",selected:"102727412"}})}),test("Should use default language if something is wrong with the locale",function(){a.get.returns("wrong"),l.selection("label","value","group"),s.calledOnce(t),s.calledWith(t,{name:"jira.dotdialog.selection",data:{lang:"en",group:"group",selected:"102727412"}})}),test("Should use default language if there is no locale",function(){a.get.returns(void 0),l.selection("label","value","group"),s.calledOnce(t),s.calledWith(t,{name:"jira.dotdialog.selection",data:{lang:"en",group:"group",selected:"102727412"}})})});