define("jira/tabs/tab-manager",["jira/util/events","jira/util/events/types","jira/util/events/reasons","jira/common/page","jira/tabs/tab-manager/util","jquery","exports"],function(t,a,e,r,n,i,o){"use strict";o.navigationTabs=function(){var o,s,l,c,d,u,b={},f={filterTabSelector:r.mainContentCssSelector,tabsSelector:"ul.vertical.tabs li",tabsLinksSelector:"ul.vertical.tabs li a",requestParams:"decorator=none&contentOnly=true",stateRequestParams:"decorator=none&contentOnly=true&updateState=true",activeTabClass:"active",loadedTabClass:"loaded",tabParam:"filterView"},m=function(t){b[t]&&b[t]instanceof Array&&i(b[t]).each(function(){this()})},h=function(r,n,o){var d=i(r).find("a"),b=u.getTabParamFromUrl(o),h=function(r){s.empty(),s.html(r),n||u.saveHistoryItem(u.constructCompleteUrl(d.attr("href"))),m(d.attr("id")),l.addClass(f.loadedTabClass),t.trigger(a.NEW_CONTENT_ADDED,[s,e.tabUpdated])};u.getTabParamFromUrl(l.find("a").attr("href"))!==b&&o&&(l.get(0)!==r||o)&&(l&&l.length&&l.removeClass(f.activeTabClass).removeClass(f.loadedTabClass),l=i(r).addClass("active"),c&&c.get(0)&&4!==c.get(0).readyState&&c.get(0).abort&&(i.isFunction(c.hideThrobber)&&c.hideThrobber(),c.get(0).abort()),s.html(i("<h2 />").text(d.attr("title"))),c=i(i.ajax({method:"get",dataType:"html",url:o,data:f.requestParams,success:h}).fail(function(t){if(401===t.status)window.location.reload();else if("abort"!==t.statusText){var a=t.responseText&&t.responseText.match(/<body[^>]*>([\S\s]*)<\/body[^>]*>/);a&&a.length>0&&s.html('<div style="padding:0 20px">'+a[1]+"</div>")}})).throbber({target:r}))},g=function(t){var a,e=f.getTabRegEx,r=t.match(e);return i(d).each(function(){var t=i(this).find("a").attr("href").match(e);r&&r.length>0&&t[0]===r[0]&&(a=this)}),a},T=function(t){var a=i([]);u.getTabParamFromUrl(l.find("a").attr("href"))!==t&&(t&&""!==t?a=g(t):""===t&&(a=o),a&&h(a,!0,i(a).find("a").attr("href")))};return window.addEventListener("popstate",function(){u&&T(u.getTabParamFromUrl(window.location.href))}),{getActiveTab:function(){return l},getProjectTab:function(){return s},addLoadEvent:function(t,a){b[t]=b[t]||[],i.isFunction(a)&&b[t].push(a)},_getTabManagerUtil:function(){return u},_getNavigateToTabFunc:function(){return h},init:function(t){i.extend(f,t),f.getTabRegEx=new RegExp(f.tabParam+"=[^&]*"),u=new n(window.location.href,f.tabParam,f.getTabRegEx),s=i(f.filterTabSelector),d=i(f.tabsSelector).each(function(){i(this).hasClass(f.activeTabClass)&&(l=i(this),l.addClass(f.loadedTabClass),o=l)});var a=g(window.location.href);if(!window.location.href.match(f.getTabRegEx)&&o){var e=i(o).find("a").attr("href");u.replaceHistoryItem(u.updateInitialUrl(e))}var r=u.getTabParamFromUrl(window.location.href);if(r&&a&&l&&u.getTabParamFromUrl(l.find("a").attr("href"))!==r){var c=i(a).find("a").attr("href");h(i(a),!0,c)}i(f.tabsLinksSelector).click(function(t){var a=i(this).attr("href"),e=g(a);e&&(h(e,!1,a),t.preventDefault())}),t&&t.customInit&&t.customInit()}}}()}),AJS.namespace("jira.app.manageShared",null,require("jira/tabs/tab-manager")),AJS.namespace("JIRA.TabManager",null,require("jira/tabs/tab-manager"));