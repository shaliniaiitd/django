AJS.test.require(["jira.webresources:select-pickers"],function(){"use strict";function e(e,t){t.forEach(function(t){var a=t.attr,r=t.value;equal(e.$field.attr(a),r,"expected "+a+"="+r)})}var t=require("jquery"),a=require("jira/jquery/deferred"),r=require("jira/ajs/select/queryable-dropdown-select");module("QueryableDropdownSelect"),test("Should get results before rendering dropdown (such that positioning won't be borked)",function(){var e=this,o=new r({element:t("<ul></ul>")});e.stub(o,"getQueryVal",function(){return"one"}),e.stub(o,"requestSuggestions",function(){return(new a).resolve(["one","two"]).promise()});var n=e.spy(o.listController,"generateListFromJSON"),i=e.spy(o.dropdownController,"show"),l=e.spy(o.dropdownController,"setPosition");o.onEdit(),ok(n.calledBefore(i),"should have results before we render a dropdown with them in it (to prevent things like TF-39)"),ok(n.calledBefore(l),"should have results before we calc and position a dropdown with them in it (to prevent things like TF-39)")}),test("ariaLabel",function(){var e=new r({element:t("<ul></ul>"),ariaLabel:"Test Label"});equal(e.$field.attr("aria-label"),"Test Label","aria-label attribute should be set from options")}),test("the dropdown trigger should have correct attributes",function(){var e=new r({element:t("<ul></ul>"),ariaLabel:"Test Label"});equal(e.$dropDownIcon.attr("tabindex"),"-1","Dropdown should have tabindex set to -1")}),test("verify combobox attributes (compat with Aria 1.0 and 1.2)",function(){e(new r({element:t("<ul></ul>")}),[{attr:"role",value:"combobox"},{attr:"autocomplete",value:"off"},{attr:"aria-autocomplete",value:"list"},{attr:"aria-expanded",value:"false"},{attr:"aria-haspopup",value:void 0}])}),test("verify combobox attributes when expanded (compat with Aria 1.0 and 1.2)",function(a){var o=a.async(),n=new r({element:t("<ul></ul>"),id:"uniqueId"});n.showSuggestions(),n.listController.focus();var i=[{attr:"aria-controls",value:"uniqueId-suggestions"},{attr:"aria-owns",value:"uniqueId-suggestions"},{attr:"aria-expanded",value:"true"},{attr:"aria-activedescendant",value:"null"}];setTimeout(function(){e(n,i),o()},100)}),test("verify combobox attributes when collapsed (compat with Aria 1.0 and 1.2)",function(){var a=new r({element:t("<ul></ul>")});a.showSuggestions(),a.hideSuggestions(),e(a,[{attr:"aria-controls",value:void 0},{attr:"aria-owns",value:void 0},{attr:"aria-expanded",value:"false"},{attr:"aria-activedescendant",value:void 0}])})});