AJS.test.require(["jira.webresources:jira-global","jira.webresources:select-pickers","com.atlassian.auiplugin:ajs-underscorejs-amd-shim"],function(){"use strict";function e(e,i){e=e||{},i=i||"";var s=t('<select class="select" '+i+' data-placeholder-text="Find Projects..." id="searcher-pid" multiple="multiple" name="pid" size="5" style="display: none; ">\n    <optgroup label="All Projects">\n        <option data-icon="/jira/secure/projectavatar?pid=10021&amp;size=small" title="Billabong" value="10021">Billabong</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10020&amp;size=small" title="Hurley" value="10020">Hurley</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10023&amp;size=small" title="Insight" value="10023">Insight</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10026&amp;size=small" title="Nike 6.0" value="10026">Nike 6.0</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10022&amp;size=small" title="Quiksilver" value="10022">Quiksilver</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10028&amp;size=small" title="Ripcurl" value="10028">Ripcurl</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10025&amp;size=small" title="Stussy" value="10025">Stussy</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10027&amp;size=small" title="Surfrider Foundation" value="10027">Surfrider Foundation</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10024&amp;size=small" title="Volcom" value="10024">Volcom</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10024&amp;size=small" data-icon-type="rounded" title="Volcom" value="10088">Volly</option>\n    </optgroup>\n</select>').appendTo("body");return new n(Object.assign({element:s,stallEventBind:!1},e))}var t=require("jquery"),i=require("underscore"),n=require("jira/ajs/select/checkbox-multi-select");module("CheckboxMultiSelect",{setup:function(){function e(e){return e?t("#searcher-pid-suggestions").find(e).find("li.check-list-item"):t("#searcher-pid-suggestions li.check-list-item")}function s(t,i){return e(i).filter(":contains("+t+")")}function o(){return t("#searcher-pid-suggestions li.no-suggestions")}function a(e){return c.find("option:contains("+e+")")}function l(){return u.getQueryVal()}function r(e){var i={38:"Up",40:"Down",13:"Return",8:"Backspace"},n="string"==typeof e;n||(e=i[e]);var s=new t.Event("aui:keydown");s.key=e,u.$field.trigger(s),(n||"Backspace"===e)&&(s=new t.Event("aui:keypress"),s.key=e,u.$field.trigger(s)),n&&u.$field.val(u.$field.val()+e),"Backspace"===e&&u.$field.val(u.$field.val().substring(0,u.$field.val().length-1)),u.$field.trigger("keyup")}t.fn.tipsy=function(){};var c=t('<select class="select" data-placeholder-text="Find Projects..." id="searcher-pid" multiple="multiple" name="pid" size="5" style="display: none; ">\n    <optgroup label="All Projects">\n        <option selected="selected" data-icon="/jira/secure/projectavatar?pid=10021&amp;size=small" title="Billabong" value="10021">Billabong</option>\n        <option selected="selected" data-icon="/jira/secure/projectavatar?pid=10020&amp;size=small" title="Hurley" value="10020">Hurley</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10023&amp;size=small" title="Insight" value="10023">Insight</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10026&amp;size=small" title="Nike 6.0" value="10026">Nike 6.0</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10022&amp;size=small" title="Quiksilver" value="10022">Quiksilver</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10028&amp;size=small" title="Ripcurl" value="10028">Ripcurl</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10025&amp;size=small" title="Stussy" value="10025">Stussy</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10027&amp;size=small" title="Surfrider Foundation" value="10027">Surfrider Foundation</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10024&amp;size=small" title="Volcom" value="10024">Volcom</option>\n        <option data-icon="/jira/secure/projectavatar?pid=10024&amp;size=small" data-icon-type="rounded" title="Volcom" value="10088">Volly</option>\n    </optgroup>\n</select>').appendTo("body"),u=new n({element:c,stallEventBind:!1,ariaLabel:"Test label"});this.control=u,this.tester={type:function(e){return u.$field.focus().val(e).trigger("input"),this},down:function(){return u.$field.focus(),r(40),this},up:function(){return u.$field.focus(),r(38),this},accept:function(){return u.$field.focus(),r(13),this},clear:function(){return this.type("")},selectByText:function(e){s(e).find("input").trigger("change")},clearSelection:function(){c.trigger("clear")},clearQueryField:function(){u.$dropDownIcon.click()}},this.GROUPS={selectedProjects:".selected-group"},this.assert={noneSelected:function(){equal(e().find(":checked").length,0,"No suggestion is checked"),equal(c.val(),null,"<select> has empty value")},selected:function(){var e=[];i.each(arguments,function(t){var i=s(t);i.length&&ok(1===i.find(":checked").length,'Expected suggestion "'+t+'" to be checked');var n=a(t);ok(n.is(":selected"),'Expected option "'+t+'" to be selected in <select>'),e.push(n.val())}),equal(JSON.stringify(c.val()),JSON.stringify(e))},selectedInGroup:function(e,t){var n=[];i.each(t,function(t){var i=s(t,e);i.length&&ok(1===i.find(":checked").length,'Expected suggestion "'+t+'" to be checked');var o=a(t);ok(o.is(":selected"),'Expected option "'+t+'" to be selected in <select>'),n.push(o.val())}),equal(JSON.stringify(c.val()),JSON.stringify(n))},suggestions:function(){equal(e().length,arguments.length,"Expected "+arguments.length+" suggestions present"),i.each(arguments,function(e){ok(1===s(e).length,'Expected suggestion "'+e+'" to be present')})},element:function(t,i){equal(e().find(t).length,i,"Expected "+i+" elements "+t+" present")},noSuggestions:function(){equal(e().length,0,"Expected no suggestions to be present"),equal(o().length,1,"Expected the 'No Matches' hint to be present")},bolded:function(){var n=e().find("em");equal(n.length,arguments.length,"Expected "+arguments.length+" to be bolded"),i.each(arguments,function(e,i){equal(t.trim(n.eq(i).text()),e,"Expected text ["+e+"] to be bolded")})},allSuggestions:function(){this.suggestions("Billabong","Hurley","Quiksilver","Insight","Nike 6.0","Ripcurl","Stussy","Surfrider Foundation","Volcom","Volly")},clearQueryIcon:function(e){equal(!!l(),e,"Expected clear query icon to be visible when the query field has text in it")},emptyQueryField:function(){ok(!l(),"Expected query field to be empty")}}},teardown:function(){t("#searcher-pid-multi-select").remove(),t("#searcher-pid").remove()}}),test("correct init state",function(){this.assert.selectedInGroup(this.GROUPS.selectedProjects,["Billabong","Hurley"]),this.assert.allSuggestions()}),test("selecting/unselecting options",function(){this.tester.down().accept().down().accept(),this.assert.selected("Billabong","Insight"),this.tester.accept().down().accept().down().accept(),this.assert.selected("Billabong","Nike 6.0","Quiksilver")}),test("Querying",function(){this.tester.type("vol"),this.assert.suggestions("Volcom","Volly"),this.assert.bolded("Vol","Vol"),this.tester.type("xxx"),this.assert.noSuggestions(),this.assert.bolded(),this.tester.clear(),this.assert.allSuggestions(),this.assert.bolded()}),test("Icon type",function(){this.tester.type("Volly"),this.assert.element(".icon.rounded",1)}),test("Selecting other than highlighted selects only selected",function(){this.tester.down().down().down(),this.tester.selectByText("Insight"),this.assert.selected("Billabong","Hurley","Insight")}),test("Selected group is restored when no input value",function(){this.tester.type("blah").clear(),this.assert.selectedInGroup(this.GROUPS.selectedProjects,["Billabong","Hurley"])}),test("Clearing all selections",function(){this.tester.clearSelection(),this.assert.noneSelected()}),test("Clicking clear query icon when there is text removes all text",function(){this.assert.clearQueryIcon(!1),this.tester.type("vol"),this.assert.clearQueryIcon(!0),this.tester.clearQueryField(),this.assert.clearQueryIcon(!1),this.assert.emptyQueryField()}),test("Selecting item updates aria-activedescendant attribute correctly.",function(){var e=sinon.useFakeTimers();this.tester.down(),e.tick(50),ok(this.control.$field.attr("aria-activedescendant").startsWith("10020"),"Aria-activedescendant points to the correct field.")}),test("aria-label attribute should be set from ariaLabel option.",function(){equal(this.control.$field.attr("aria-label"),"Test label")}),module("CheckboxMultiSelect with limited options",{setup:function(){t.fn.tipsy=function(){}},teardown:function(){t("#searcher-pid-multi-select").remove(),t("#searcher-pid").remove()}}),test("Initializes with limited options specified with data attribute",function(){var t=e({},'data-max-inline-results-displayed="5"');equal(t.$container.find(".check-list-item").length,5,"Limits visible options"),ok(t.$container.html().includes("common.concepts.too.many.matches"),"Displays notice to end user")}),test("Initializes with limited options specified with JS",function(){var t=e({maxInlineResultsDisplayed:5});equal(t.$container.find(".check-list-item").length,5,"Limits visible options"),ok(t.$container.html().includes("common.concepts.too.many.matches"),"Displays notice to end user")})});