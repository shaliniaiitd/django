define("jira/customfields/customfieldsRecalculationDetailsView",["jira/backbone-1.3.3","jira/marionette-4.1","jira/moment","jira/ajs/ajax/smart-ajax","wrm/context-path"],function(e,t,i,s,a){"use strict";var o=a()+"/rest/api/2/application-properties?key=com.atlassian.jira.issue.fields.usage.calc.date";return t.View.extend({initialize:function(){this.model=new e.Model({isReady:!1,issuesRecalculationDate:null}),this.listenTo(this.model,"change",this.render.bind(this)),this.poll=this.poll.bind(this),this.poll()},template:JIRA.Templates.Admin.Customfields.recalculationDetails,templateContext:function(){return{issuesRecalculationDate:this.model.get("issuesRecalculationDate"),isReady:this.model.get("isReady")}},onBeforeDestroy:function(){clearTimeout(this.pollTimeout)},onRender:function(){this.$(".customfield-help-icon").tooltip({gravity:"ne"})},poll:function(){var e=this;s.makeRequest({url:o,success:function(t){var i=Number(t.value);0===i||Number.isNaN(i)?e.setError():e.setDate(i)},error:function(){e.model.get("issuesRecalculationDate")||e.setError()},complete:function(){e.pollTimeout=setTimeout(e.poll,6e4)}})},setDate:function(e){this.model.set({isReady:!0,issuesRecalculationDate:i(e).format("LLL")})},setError:function(){this.model.set({isReady:!0,issuesRecalculationDate:null})}})});