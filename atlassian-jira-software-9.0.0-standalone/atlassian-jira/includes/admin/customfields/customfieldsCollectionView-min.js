define("jira/customfields/customfieldCollectionView",["jquery","jira/marionette-4.1","jira/analytics","jira/util/data/meta","jira/util/formatter","jira/customfields/customfieldRowView","jira/featureflags/feature-manager"],function(e,t,i,n,r,o,s){"use strict";return t.CollectionView.extend({tagName:"table",id:"custom-fields-table",className:"aui jira-sortable-table",template:JIRA.Templates.Admin.Customfields.customfieldsTableContent,templateContext:function(){return{showUsageData:s.isFeatureEnabled("jira.customfields.cleanup.identification"),showBulkOperations:s.isFeatureEnabled("jira.customfields.bulk.delete")}},childView:o,childViewContainer:"tbody",childViewTriggers:{"delete:click":"customfield:delete:click","checkbox:change":"customfield:checkbox:change"},childViewOptions:function(){return{isMultiLingual:n.get("is-multilingual")}},events:{"click .sortable":"onSortStart","click .custom-fields-bulk-delete":"onBulkDeleteClick","change .custom-fields-bulk-checkbox":"onBulkCheckboxChange"},onSortStart:function(e){var t=this;this.trigger("sort:start");var i=this.updateSorting(e),n=i.sortOrder,r=i.sortColumn;this.collection.filters.sortColumn=r,this.collection.filters.sortOrder=n,this.sendSortingAnalyticsEvent(r,n),this.collection.getFirstPage({reset:!0}).always(function(){t.trigger("sort:end")}).fail(function(e){return t.triggerMethod("navigate:error",e)})},sendSortingAnalyticsEvent:function(e,t){i.send({name:"administration.customfields.sorted",properties:{sortColumn:e||"none",sortOrder:t||"none"}})},emptyView:t.View.extend({tagName:"tr",template:function(e){return e.extraClasses="no-project-results",e.colspan=5,e.name=r.I18n.getText("admin.issuefields.customfields.no.results.name"),JIRA.Templates.Common.emptySearchTableRow(e)}}),getNextSortOrder:function(e){return null===e?"ascending":"ascending"===e?"descending":null},updateSortingUI:function(e,t){this.$("thead").replaceWith(JIRA.Templates.Admin.Customfields.customfieldsTableHeader({sortOrder:e,sortColumn:t,showBulkOperations:s.isFeatureEnabled("jira.customfields.bulk.delete"),showUsageData:s.isFeatureEnabled("jira.customfields.cleanup.identification")}))},updateSorting:function(t){var i=e(t.currentTarget),n=i.data("sort-order")||null,r=this.getNextSortOrder(n),o=r?i.data("sort-key"):null;return this.updateSortingUI(r,o),{sortOrder:r,sortColumn:o}},onBulkDeleteClick:function(){this.trigger("bulk:deleteButton:click")},onBulkCheckboxChange:function(){this.trigger("bulk:checkbox:change")}})});